<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard de Obras - LUMOB</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/form.css') }}"
    />
    <style>
      /* Estilos básicos para o dashboard. Você pode integrá-los ao seu style.css ou criar um dashboard.css */
      body {
        font-family: sans-serif;
        margin: 20px;
        background-color: #f0f2f5;
      }
      .container {
        max-width: 1200px;
        margin: auto;
        padding: 25px;
        border: 1px solid #ddd;
        border-radius: 10px;
        background-color: #fff;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
      }
      h1 {
        text-align: center;
        color: #333;
        margin-bottom: 30px;
      }
      .kpis-container {
        display: flex;
        justify-content: space-around;
        flex-wrap: wrap;
        gap: 20px;
        margin-bottom: 40px;
      }
      .kpi-card {
        background-color: #e9f5ff; /* Um azul mais suave */
        border: 1px solid #cce5ff;
        border-radius: 10px;
        padding: 25px;
        text-align: center;
        flex: 1;
        min-width: 250px; /* Aumenta a largura mínima para melhor leitura */
        box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s ease;
      }
      .kpi-card:hover {
        transform: translateY(-5px);
      }
      .kpi-card h4 {
        margin-top: 0;
        color: #0056b3; /* Cor mais escura para o título do KPI */
        font-size: 1.1em;
        margin-bottom: 15px;
      }
      .kpi-card p {
        font-size: 2.5em; /* Aumenta o tamanho da fonte para o valor */
        font-weight: bold;
        color: #007bff; /* Cor principal do valor */
        margin-bottom: 0;
      }
      .dashboard-section {
        background-color: #fff;
        border: 1px solid #eee;
        border-radius: 8px;
        padding: 25px;
        margin-bottom: 25px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
      }
      .dashboard-section h3 {
        color: #333;
        margin-top: 0;
        border-bottom: 1px solid #eee;
        padding-bottom: 15px;
        margin-bottom: 20px;
      }
      /* Estilos para mensagens flash, se não estiverem em style.css */
      .flash-messages {
        list-style: none;
        padding: 0;
        margin-bottom: 20px;
      }
      .flash-messages li {
        padding: 10px 15px;
        margin-bottom: 10px;
        border-radius: 5px;
        font-weight: bold;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }
      .flash-messages .success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .flash-messages .danger {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6fb;
      }
      .flash-messages .warning {
        background-color: #fff3cd;
        color: #856404;
        border: 1px solid #ffeeba;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="container">
        <h1>Dashboard de Obras</h1>
        <nav>
          <a href="{{ url_for('welcome') }}">Início</a> |
          <a href="{{ url_for('obras_module') }}">Módulo Obras</a> |
          <a href="{{ url_for('logout') }}">Sair</a>
        </nav>
      </div>
    </header>

    <main class="container">
      {% with messages = get_flashed_messages(with_categories=true) %} {% if
      messages %}
      <ul class="flash-messages">
        {% for category, message in messages %}
        <li class="{{ category }}">{{ message }}</li>
        {% endfor %}
      </ul>
      {% endif %} {% endwith %}

      <div class="kpis-container">
        <div class="kpi-card">
          <h4>Obras em Andamento</h4>
          <p>{{ status_counts.get('Em Andamento', 0) }}</p>
        </div>
        <div class="kpi-card">
          <h4>Obras Concluídas</h4>
          <p>{{ status_counts.get('Concluída', 0) }}</p>
        </div>
        <div class="kpi-card">
          <h4>Total de Obras (Geral)</h4>
          {# Calcule a soma total iterando sobre os valores de 'Count' #}
          <p>
            {% set total_obras = 0 %} {% for status, count in
            status_counts.items() %} {% set total_obras = total_obras + count %}
            {% endfor %} {{ total_obras }}
          </p>
        </div>
        <div class="kpi-card">
          <h4>Valor Total de Contratos Ativos</h4>
          <p>{{ total_contratos_ativos }}</p>
        </div>
        <div class="kpi-card">
          <h4>Total de Medições Realizadas</h4>
          <p>{{ total_medicoes_realizadas }}</p>
        </div>
        <div class="kpi-card">
          <h4>Avanço Físico Médio (Ativas)</h4>
          <p>{{ avg_avanco_fisico }}</p>
        </div>
      </div>

      <div class="dashboard-section">
        <h3>Distribuição de Obras por Status</h3>
        {# Aqui você pode adicionar um gráfico JS futuramente. Por enquanto, uma
        lista ou tabela #} {% if status_counts %}
        <ul>
          {% for status, count in status_counts.items() %}
          <li><strong>{{ status }}:</strong> {{ count }} obras</li>
          {% endfor %}
        </ul>
        {% else %}
        <p>Nenhuma obra encontrada para exibir a distribuição por status.</p>
        {% endif %}
      </div>

      {# Futuramente, mais seções de relatórios ou tabelas de detalhes #}
    </main>

    <footer>
      <div class="container">
        <p>&copy; 2025 LUMOB - Sistema de Gestão Interna</p>
      </div>
    </footer>
  </body>
</html>
